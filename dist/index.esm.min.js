/*! navigation 0.2.0 — © MEOM */
function e(e,t,s){e&&t&&(e.classList.add(t),e.addEventListener("animationend",(function n(){e.classList.remove(t),s&&e.classList.remove(s),e.removeEventListener("animationend",n,!1)}),!1))}function t(e,t){if(void 0===e||0>=t.length)return;const s="true"===e.getAttribute(`aria-${t}`)?"false":"true";e.setAttribute(`aria-${t}`,s)}function s(e,t,s={}){this._handleNav=this.handleNav.bind(this),this._handleSubNav=this.handleSubNav.bind(this),this._handleCloseNav=this.handleCloseNav.bind(this),this._handleCloseSubNav=this.handleCloseSubNav.bind(this),this._closeAllSubMenus=this.closeAllSubMenus.bind(this),this._setSubMenu=this.setSubMenu.bind(this),this._closeAllSubMenuToggles=this.closeAllSubMenuToggles.bind(this),this._handleDocClick=this.handleDocClick.bind(this),this._handleFocus=this.handleFocus.bind(this);const n={action:"click",toggleNavClass:!0,navClass:"is-opened",closeNavOnEscKey:!0,closeNavOnLastTab:!1,subNavAnchors:".menu-item-has-children.is-item-level-0 > a",subSubNavAnchors:"ul .menu-item-has-children > a",subNavClass:".sub-menu",subToggleButtonClasses:"",subSubToggleButtonClasses:"",animateSubNav:!1,animateSubNavClass:"",visuallyHiddenClass:"screen-reader-text",expandChildNavText:"Child menu",dropDownIcon:'<svg class="icon" aria-hidden="true" focusable="false" width="13" height="8" viewBox="0 0 13 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1l4.793 4.793a1 1 0 001.414 0L12 1" stroke-width="2" stroke-linecap="round"></path></svg>',onCreate:null,onOpenNav:null,onCloseNav:null,onOpenSubNav:null,onCloseSubNav:null,...s};this.$element=e,this.$toggle=t,this.settings=n,this.navOpened=!1,this.$subNavs=this.$element.querySelectorAll(this.settings.subNavAnchors),this.$subSubNavs=this.$element.querySelectorAll(this.settings.subSubNavAnchors),this.create()}s.prototype.create=function(){return this.$toggle.setAttribute("aria-expanded","false"),this.$element.setAttribute("data-meom-nav","navigation"),this.$subNavs.forEach((function(e,t){"click"===this.settings.action&&e.setAttribute("hidden","");const s=document.createElement("button");s.setAttribute("data-meom-nav","sub-toggle"),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",`sub-menu-${t}`),e.nextElementSibling&&(e.nextElementSibling.id=`sub-menu-${t}`),s.className=`${this.settings.subToggleButtonClasses}`,s.type="button","click"===this.settings.action&&(s.innerHTML=`${e.textContent}${this.settings.dropDownIcon}`),"hover"===this.settings.action&&(s.innerHTML=`<span class="${this.settings.visuallyHiddenClass}">${this.settings.expandChildNavText}</span>${this.settings.dropDownIcon}`),e.after(s)}),this),this.$subSubNavs.forEach((function(e,t){const s=document.createElement("button");s.setAttribute("data-meom-nav","sub-sub-toggle"),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",`sub-sub-menu-${t}`),e.nextElementSibling&&(e.nextElementSibling.id=`sub-sub-menu-${t}`),s.className=`${this.settings.subSubToggleButtonClasses}`,s.type="button",s.innerHTML=`<span class="${this.settings.visuallyHiddenClass}">${this.settings.expandChildNavText}</span>${this.settings.dropDownIcon}`,e.after(s)}),this),this.$toggle.addEventListener("click",this._handleNav,!1),this.$element.addEventListener("click",this._handleSubNav,!1),document.addEventListener("keydown",this._handleCloseNav,!1),this.$element.addEventListener("keydown",this._handleCloseSubNav,!1),this.$element.addEventListener("keydown",this._handleFocus,!1),document.addEventListener("click",this._handleDocClick,!1),this.settings.onCreate&&"function"==typeof this.settings.onCreate&&this.settings.onCreate(this.$element,this.$toggle),this},s.prototype.handleNav=function(e){return this.navOpened?(t(this.$toggle,"expanded"),this.settings.toggleNavClass&&this.$element.classList.remove("is-opened"),this.$toggle&&this.$toggle.focus(),this.navOpened=!1,this._closeAllSubMenus(),this._closeAllSubMenuToggles(),this.settings.onCloseNav&&"function"==typeof this.settings.onCloseNav&&this.settings.onCloseNav(this.$element,this.$toggle,e)):(t(this.$toggle,"expanded"),this.settings.toggleNavClass&&this.$element.classList.add("is-opened"),this.navOpened=!0,this.settings.onOpenNav&&"function"==typeof this.settings.onOpenNav&&this.settings.onOpenNav(this.$element,this.$toggle,e)),this},s.prototype.handleSubNav=function(e){const s=e.target,n=s.closest('[data-meom-nav="sub-toggle"]'),i=s.closest('[data-meom-nav="sub-sub-toggle"]');return n||i?(s.nextElementSibling.classList.contains("is-opened")||s.matches('[data-meom-nav="sub-sub-toggle"]')||(this._closeAllSubMenus(),this._closeAllSubMenuToggles()),t(s,"expanded"),s.nextElementSibling&&this._setSubMenu(s.nextElementSibling,e),this):this},s.prototype.handleCloseNav=function(e){return this.navOpened&&this.settings.closeNavOnEscKey&&27===e.keyCode&&this._handleNav(e),this},s.prototype.handleCloseSubNav=function(e){const t=document.querySelector(`${this.settings.subNavClass}.is-opened`);if(t){const s=t.querySelectorAll(["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])"]),n=s[s.length-1];9!==e.keyCode||e.shiftKey||e.target!==n||(this._closeAllSubMenus(),this._closeAllSubMenuToggles());const i=t.previousElementSibling;i&&9===e.keyCode&&e.shiftKey&&e.target===i&&(this._closeAllSubMenus(),this._closeAllSubMenuToggles())}if(27===e.keyCode){if(e.target.matches('[data-meom-nav="sub-toggle"][aria-expanded="true"]'))return this._handleSubNav(e),this._closeAllSubMenus(),this._closeAllSubMenuToggles(),this;const t=e.target.closest(`${this.settings.subNavClass}.is-opened`);if(t){const e=t.previousElementSibling;e&&e.focus()}this._closeAllSubMenus(),this._closeAllSubMenuToggles()}return this},s.prototype.handleFocus=function(e){if(!this.navOpened)return this;if(!this.settings.closeNavOnLastTab)return this;const t=this.$element.querySelectorAll(["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])"]),s=t[t.length-1];return 9!==e.keyCode||e.shiftKey||e.target!==s||(e.preventDefault(),this._handleNav(e)),this},s.prototype.handleDocClick=function(e){return e.target.closest('[data-meom-nav="navigation"]')||(this._closeAllSubMenus(),this._closeAllSubMenuToggles()),this},s.prototype.closeAllSubMenus=function(){return document.querySelectorAll(`${this.settings.subNavClass}.is-opened`).forEach((function(e){this._setSubMenu(e)}),this),this},s.prototype.setSubMenu=function(t,s){return t?(t.classList.contains("is-opened")?(t.classList.remove("is-opened"),this.settings.onCloseSubNav&&"function"==typeof this.settings.onCloseSubNav&&this.settings.onCloseSubNav(this.$element,this.$toggle,t,s)):(t.classList.add("is-opened"),this.settings.animateSubNav&&e(t,this.settings.animateSubNavClass),this.settings.onOpenSubNav&&"function"==typeof this.settings.onOpenSubNav&&this.settings.onOpenSubNav(this.$element,this.$toggle,t,s)),this):this},s.prototype.closeAllSubMenuToggles=function(){document.querySelectorAll('[data-meom-nav="sub-toggle"][aria-expanded="true"]').forEach((function(e){t(e,"expanded")}));return document.querySelectorAll('[data-meom-nav="sub-sub-toggle"][aria-expanded="true"]').forEach((function(e){t(e,"expanded")})),this};export{s as Navigation,e as animate,t as updateAria};
